on_orbital_complete_effect = {
	fromfrom.solar_system = {
		random_system_planet = {
			limit = {
				has_planet_flag = habitat
			}
			save_event_target_as = target_habitat
		}
	}
	event_target:target_planet = {
		set_planet_flag = has_megastructure

		if = {
			limit = {
				has_orbital_station = yes
				has_owner = yes
				owner = {
					is_ai = yes
				}
			}
			orbital_station = {
				dismantle = yes
			}
		}

		create_fleet = {
			effect = {
				set_owner = FROM
				create_ship = {
					random_existing_design = $BODY$_orbital_$TYPE$
					effect = {
						set_disable_at_health = 0.05
						set_name = {
							key = TARGET_ORBITAL_NAME
							variable_string = "\\[FROM.from.planet.GetName]"
						}
					}
				}
				save_event_target_as = target_orbital
				fleet = {
					set_location = {
						target = event_target:target_planet
					}
				}
			}
		}
		event_target:target_orbital = {
			set_name = {
				key = TARGET_ORBITAL_NAME
				variable_string = "\\[FROM.from.planet.GetName]"
			}
		}

		set_habitat_planetary_features_effect = yes

		if = {
			limit = {
				OR = {
					AND = {
						has_owner = yes
						owner = {
							is_ai = yes
						}
						event_target:target_planet = {
							has_deposit_for = shipclass_research_station
						}
					}
					AND = {
						has_owner = yes
						owner = {
							is_ai = no
						}
					}
				}
			}
			event_target:target_orbital = {
				set_fleet_flag = science_orbital
			}
		}
		if = {
			limit = {
				OR = {
					AND = {
						has_owner = yes
						owner = {
							is_ai = yes
						}
						event_target:target_planet = {
							has_orbital_mining_deposit = yes
						}
					}
					AND = {
						has_owner = yes
						owner = {
							is_ai = no
						}
					}
				}
			}
			event_target:target_orbital = {
				set_fleet_flag = mining_orbital
			}
		}
		if = {
			limit = {
				OR = {
					AND = {
						has_owner = yes
						owner = {
							is_ai = yes
						}
						event_target:target_planet = {
							has_orbital_energy_deposit = yes
						}
					}
					AND = {
						has_owner = yes
						owner = {
							is_ai = no
						}
					}
				}
			}
			event_target:target_orbital = {
				set_fleet_flag = energy_orbital
			}
		}
	}
	if = {
		limit = {
			fromfrom = {
				is_scope_type = megastructure
			}
		}
		remove_megastructure = fromfrom
	}
}

set_habitat_planetary_features_effect = {
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_exotic_gases_1 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_gas_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_exotic_gases_2 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_gas_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_exotic_gases_3 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_gas_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_exotic_gases_4 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_gas_4
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_exotic_gases_5 }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_gas_5
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_rare_crystals_1 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_crystal_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_rare_crystals_2 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_crystal_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_rare_crystals_3 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_crystal_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_rare_crystals_4 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_crystal_4
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_rare_crystals_5 }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_crystal_5
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_volatile_motes_1 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_mote_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_volatile_motes_2 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_mote_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_volatile_motes_3 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_mote_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_volatile_motes_4 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_mote_4
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_volatile_motes_5 }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_mote_5
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_zro_deposit_1 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_zro_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_zro_deposit_2 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_zro_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_zro_deposit_3 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_zro_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_zro_deposit_4 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_zro_4
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_zro_deposit_5 }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_zro_5
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_dark_matter_deposit_1 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_dark_matter_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_dark_matter_deposit_2 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_dark_matter_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_dark_matter_deposit_3 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_dark_matter_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_dark_matter_deposit_10 }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_dark_matter_10
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_living_metal_deposit }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_living_metal_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_alloys_1 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_alloy_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_alloys_2 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_alloy_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_alloys_3 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_alloy_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_alloys_4 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_alloy_4
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_alloys_5 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_alloy_5
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_alloys_10 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_alloy_10
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_alloys_25 }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_alloy_25
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_consumer_goods_obsessional_directive }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_consumer_goods_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_nanites_deposit }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_nanites_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_nanite_harvester_deposit }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_harvester_nanites_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_nanite_harvester_deposit_regular }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_harvester_nanites_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_nanite_harvester_deposit_large }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_harvester_nanites_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_artifacts_research_1 }
		}
		event_target:target_habitat = {
			add_deposit = d_artifacts_planet_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_artifacts_research_2 }
		}
		event_target:target_habitat = {
			add_deposit = d_artifacts_planet_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_artifacts_research_3 }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_artifacts_planet_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_astral_threads_deposit_1 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_astral_threads_1
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			has_owner = yes
			owner = {
				is_ai = yes
			}
			event_target:target_planet = { has_deposit = d_astral_threads_deposit_2 }
		}
		event_target:target_habitat = {
			add_deposit = d_hab_astral_threads_2
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}

	if = {
		limit = {
			OR = {
				AND = {
					has_owner = yes
					owner = {
						is_ai = yes
					}
					event_target:target_planet = { has_deposit = d_astral_threads_deposit_3 }
				}
				AND = {
					has_owner = yes
					owner = {
						is_ai = no
					}
				}
			}
		}
		event_target:target_habitat = {
			add_deposit = d_hab_astral_threads_3
			last_added_deposit = {
				set_deposit_flag = planet@event_target:target_planet
			}
		}
	}
}