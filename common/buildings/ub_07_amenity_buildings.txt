#############
# Amenities buildings
#############

ub_building_clinic = {
	icon = building_clinic
	base_buildtime = @b1_time

	category = amenity

	potential = {
		exists = owner
		# check the empire is valid
		owner = {
			# rule out gestalts and pre-FTL societies
			is_individual_machine = no
			OR = {
				is_regular_empire = yes
				AND = {
					has_origin = origin_fear_of_the_dark
					is_country_type = primitive
				}
			}
			# rule out AI empires with entirely no access to "Pharma State" Civic, unless the planet is unstable
			OR = {
				is_ai = no
				has_valid_civic = civic_private_healthcare_corporate
				prev = {
					has_branch_office = yes
					branch_office_owner = {
						has_valid_civic = civic_private_healthcare_corporate
					}
				}
				prev = {
					NOT = { has_available_jobs = entertainer }
					NOT = { has_forbidden_jobs = entertainer }
					planet_stability < 50
					free_amenities < 0
				}
			}
		}
		OR = {
			has_building = building_clinic
			has_building = building_hospital
		}
		owner = { is_ai = no }
	}

	destroy_trigger = {
		OR = {
			# if the planet is owned by a gestalt or pre-FTL society
			AND = {
				exists = owner
				owner = {
					OR = {
						is_regular_empire = no
						AND = {
							is_country_type = primitive
							NOT = { has_origin = origin_fear_of_the_dark }
						}
					}
				}
			}
			# if this is an AI-controlled empire with entirely no access to "Pharma State" Civic, assuming the planet is now stable
			AND = {
				exists = owner
				owner = {
					is_ai = yes
					NOT = {
						OR = {
							has_valid_civic = civic_private_healthcare_corporate
							prev = {
								has_branch_office = yes
								branch_office_owner = {
									has_valid_civic = civic_private_healthcare_corporate
								}
							}
						}
					}
				}
				planet_stability > 70
				free_amenities > 20
			}
		}
	}

	planet_modifier = {
		job_healthcare_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_gene_tailoring
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_origin = origin_overtuned
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 1
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = @b1_upkeep
		}
	}

	prerequisites = {
		"tech_frontier_health"
	}

	upgrades = {
		"building_hospital"
	}

	triggered_desc = {
		text = job_healthcare_effect_desc
	}

	on_destroy = {
		owner = {
			if = {
				limit = {
					has_event_chain = payback_out_of_warranty_chain
				}
				end_event_chain = payback_out_of_warranty_chain
			}
		}
	}

	on_repaired = {
		if = {
			limit = {
				planet.owner = {
					has_event_chain = payback_out_of_warranty_chain
				}
			}
			random_list = {
				50 = { # still broken
					planet.owner = {
						country_event = { id = origin.4302 }
					}
					modifier = {
						factor = 0
						planet.owner = { has_technology = tech_frontier_health }
					}
				}
				20 = { # repaired
					planet.owner = {
						country_event = { id = origin.4301 }
					}
					modifier = {
						factor = 2
						planet.owner = { num_research_agreements = 1 }
					}
					modifier = {
						factor = 3
						planet.owner = { num_research_agreements = 2 }
					}
					modifier = {
						factor = 4
						planet.owner = { num_research_agreements >= 3 }
					}
				}
				10 = { # broken beyond repair
					planet = {
						planet_event = { id = origin.4303 }
					}
				}
			}
		}
	}
}

ub_building_ranger_lodge = {
	base_buildtime = @b1_time
	category = amenity
	icon = holding_park_ranger_lodge
	potential = {
		NOT = {	has_modifier = slave_colony	}
		owner = {
			is_regular_empire = yes
			has_valid_civic = civic_environmentalist
		}
		NOR = {
			is_planet_class = pc_city
			is_planet_class = pc_hive
			is_planet_class = pc_machine
			is_planet_class = pc_relic
		}
		is_artificial = no
		has_building = building_ranger_lodge
		owner = { is_ai = no }
	}

	allow = {
		custom_tooltip = {
			fail_text = no_free_district_for_ranger_lodge
			planet = {
				num_free_districts = {
					type = any
					value > 0
				}
			}
		}
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = { is_regular_empire = no }
			has_modifier = slave_colony
			owner = { NOT = { has_valid_civic = civic_environmentalist } }
			is_planet_class = pc_city
			is_planet_class = pc_hive
			is_planet_class = pc_machine
			is_planet_class = pc_relic
		}
	}

	ai_resource_production = {
		unity = 2
		mult = value:natural_blocker_count
	}

	ai_resource_production = {
		unity = 1
		trigger = { owner_has_resolution = { RES = resolution_ecology_integrated_gardens } }
		mult = value:natural_blocker_count
	}

	ai_resource_production = {
		unity = 1
		trigger = { owner_has_resolution = { RES = resolution_ecology_environmental_control_board } }
		mult = value:natural_blocker_count
	}

	ai_resource_production = {
		unity = 1
		trigger = { owner_has_resolution = { RES = resolution_ecology_paradise_initiative } }
		mult = value:natural_blocker_count
	}

	planet_modifier = {
		job_ranger_add = 1 # 1 Ranger no matter what
		deposit_blockers_natural_unity_produces_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			always = yes
		}
		job_ranger_add = 1 # +1 Ranger per natural blocker
		mult = value:natural_blocker_count
	}

	triggered_planet_modifier = {
		potential = {
			owner_has_resolution = { RES = resolution_ecology_paradise_initiative }
		}
		job_ranger_add = 1 # +1 Ranger per natural blocker if GalCom approves
		mult = value:natural_blocker_count
	}


	triggered_planet_modifier = {
		potential = { owner_has_resolution = { RES = resolution_ecology_integrated_gardens } }
		deposit_blockers_natural_unity_produces_add = 1
	}

	triggered_planet_modifier = {
		potential = { owner_has_resolution = { RES = resolution_ecology_environmental_control_board } }
		deposit_blockers_natural_unity_produces_add = 2
	}

	triggered_planet_modifier = {
		potential = { owner_has_resolution = { RES = resolution_ecology_paradise_initiative } }
		deposit_blockers_natural_unity_produces_add = 3
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = @b1_upkeep
		}
	}

	triggered_desc = {
		text = job_ranger_effect_desc
	}

	on_built = {
		planet = {
			add_blocker = { type = d_big_nature_preserve_blocker }
		}
	}

	on_destroy = {
		planet = {
			if = {
				limit = { has_deposit = d_big_nature_preserve_blocker }
				every_deposit = {
					limit = {
						is_deposit_type = d_big_nature_preserve_blocker
					}
					remove_deposit = d_big_nature_preserve_blocker
				}
			}
		}
	}
}

ub_building_toxic_bath = {
	base_buildtime = @b1_time
	category = amenity
	icon = building_toxic_bath

	potential = {
		NOT = { has_modifier = slave_colony }
		owner = {
			is_regular_empire = yes
			OR = {
				has_valid_civic = civic_toxic_baths
				has_valid_civic = civic_corporate_toxic_baths
			}
			is_individual_machine = no
		}
		has_building = building_toxic_bath
		owner = { is_ai = no }
	}
	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				OR = {
					is_regular_empire = no
					NOR = {
						has_valid_civic = civic_toxic_baths
						has_valid_civic = civic_corporate_toxic_baths
					}
				}
			}
			has_modifier = slave_colony
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = { is_individual_machine = no }
		}
		job_bath_attendant_add = @b1_jobs
	}

	triggered_desc = {
		trigger = {
			exists = owner
			owner = { is_megacorp = no }
		}
		text = job_toxic_baths_effect_desc
	}

	resources = {
		category = planet_buildings
		cost = {
			minerals = @b1_minerals
		}
		upkeep = {
			energy = @b1_upkeep
		}
	}
}
