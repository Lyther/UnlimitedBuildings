###############################################################
# Government Building
###############################################################

building_acot_dm_ancient_palace = {
	base_buildtime = 900
	capital = yes
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	can_build = no
	position_priority = 0

	country_modifier = {
		country_resource_max_add = 10000
		country_resource_max_acot_sr_dark_energy_add = 2500
		country_resource_max_sr_dark_matter_add = 2500	
	}

	upgrades = {
		building_acot_ae_ancient_palace
	}

	category = government
	
	potential = {
		exists = planet_owner
		planet_owner = { 
			OR = {
				is_regular_empire = yes 
				is_individual_machine = yes
			}
		}
	}
	
	convert_to = {
		building_acot_dm_ancient_control_center		
		building_acot_dm_ancient_hive_cluster
	}
	
	allow = {
	}
	
	prerequisites = {
		"tech_acot_dm_ancient_palace"
	}
	
	show_tech_unlock_if = { 
		is_regular_empire = yes
	}
	
	planet_modifier = {
		planet_housing_add = 15
		planet_amenities_add = 80
		planet_max_districts_add = 4
		planet_max_buildings_add = 12
		planet_max_branch_office_buildings_add = 4
		trade_value_add = 5
		trade_value_mult = 0.50
		planet_orbital_bombardment_damage = -0.10
		pop_environment_tolerance = 0.15
		defense_armies_add = @tier_4_capital_defense_armies
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_individual_machine = yes
				NOT = {
					has_technology = tech_acot_dm_super_assembly
				}
			}
		}
		job_roboticist_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_individual_machine = yes
				has_technology = tech_acot_dm_super_assembly
			}
		}
		job_acot_roboman_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = {
				is_fallen_empire = no
			}	
		}
		modifier = {
			job_acot_overlord_add = 1
			job_acot_overseer_add = 4
			job_acot_enforcer_add = 2
		}
	}

	##### FOR FE ###

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_fallen_empire_spiritualist = no 
				is_fallen_empire = yes
			}
		}
		modifier = {
			job_fe_overseer_add = 4
			job_fe_protector_add = 4
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_fallen_empire_spiritualist = yes 
				is_fallen_empire = yes
			}
		}
		modifier = {
			job_fe_sky_cardinal_add = 4
			job_fe_protector_add = 4
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_technology = tech_capital_productivity_1 }
		}
		modifier = {
			planet_jobs_upkeep_mult = 0.1
			planet_jobs_produces_mult = 0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_technology = tech_capital_productivity_2 }
		}
		modifier = {
			planet_jobs_upkeep_mult = 0.1
			planet_jobs_produces_mult = 0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_technology = tech_capital_productivity_3 }
		}
		modifier = {
			planet_jobs_upkeep_mult = 0.1
			planet_jobs_produces_mult = 0.1
		}
	}

	resources = {
		category = planet_buildings
		produces = {
			energy = 20
			sr_dark_matter = 10	
			acot_sr_dark_energy = 10
		}
		produces = {
			trigger = {
				is_planet_class = pc_dark_fractured					
			}
			energy = 10
			sr_dark_matter = 5	
			acot_sr_dark_energy = 5
		}
		produces = {
			trigger = {
				is_planet_class = pc_acot_enigmopolis			
			}
			energy = 60
			sr_dark_matter = 30	
			acot_sr_dark_energy = 30
		}
		cost = {
			alloys = 1000
			sr_dark_matter = 100
		}			
	}
	
	ai_weight = {
		weight = 100
	}
}

# Supra Nexus
building_acot_dm_ancient_control_center = {
	base_buildtime = 900
	capital = yes
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0

	country_modifier = {
		country_resource_max_add = 10000
		country_resource_max_acot_sr_dark_energy_add = 2500
		country_resource_max_sr_dark_matter_add = 2500
	}

	category = government
	
	upgrades = {
		building_acot_ae_ancient_control_center
	}

	potential = {
		exists = planet_owner
		planet_owner = { is_machine_empire = yes }
	}
	
	convert_to = {
		building_acot_dm_ancient_palace
		building_acot_dm_ancient_hive_cluster
	}
	
	allow = {
		num_sapient_pops >= 25
	}
	
	prerequisites = {
		"tech_acot_dm_ancient_control_center"
	}
	
	show_tech_unlock_if = { 
		is_machine_empire = yes
	}
	
	planet_modifier = {
		planet_housing_add = 15
		planet_amenities_add = 80
		planet_max_districts_add = 4
		planet_max_buildings_add = 12
		planet_orbital_bombardment_damage = -0.10
		pop_environment_tolerance = 0.15
		defense_armies_add = @tier_4_capital_defense_armies
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				NOT = {
					has_technology = tech_acot_dm_super_assembly
				}
			}
		}
		job_replicator_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_acot_dm_super_assembly
			}
		}
		job_acot_robodrone_add = 1
	}

	##### FOR DEFEARTHH ###

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_fallen_empire_machine = no
			}
		}
		modifier = {
			job_acot_overlord_droid_add = 1
			job_acot_overseer_droid_add = 4
			job_acot_enforcer_drone_add = 2
		}
	}

	##### FOR FE ###

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_fallen_empire_machine = yes
			}
		}
		modifier = {
			job_fe_guardian_bot_add = 10
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_technology = tech_capital_productivity_1 }
		}
		modifier = {
			planet_jobs_upkeep_mult = 0.1
			planet_jobs_produces_mult = 0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_technology = tech_capital_productivity_2 }
		}
		modifier = {
			planet_jobs_upkeep_mult = 0.1
			planet_jobs_produces_mult = 0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_technology = tech_capital_productivity_3 }
		}
		modifier = {
			planet_jobs_upkeep_mult = 0.1
			planet_jobs_produces_mult = 0.1
		}
	}

	resources = {
		category = planet_buildings
		produces = {
			energy = 20
			sr_dark_matter = 10	
			acot_sr_dark_energy = 10
		}
		produces = {
			trigger = {
				is_planet_class = pc_dark_fractured					
			}
			energy = 10
			sr_dark_matter = 5	
			acot_sr_dark_energy = 5
		}
		produces = {
			trigger = {
				is_planet_class = pc_dark_fractured_ae			
			}
			energy = 20
			sr_dark_matter = 10	
			acot_sr_dark_energy = 10
		}
		produces = {
			trigger = {
				is_planet_class = pc_acot_enigmopolis			
			}
			energy = 60
			sr_dark_matter = 30	
			acot_sr_dark_energy = 30
		}
		cost = {
			alloys = 1000
			sr_dark_matter = 100
		}			
	}
	
	ai_weight = {
		weight = 100
	}
}

# Hive Nexus
building_acot_dm_ancient_hive_cluster = {
	base_buildtime = 900
	capital = yes
	can_build = no
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 0

	country_modifier = {
		country_resource_max_add = 10000
		country_resource_max_acot_sr_dark_energy_add = 2500
		country_resource_max_sr_dark_matter_add = 2500	
	}

	upgrades = {
		building_acot_ae_ancient_hive_cluster
	}

	category = government
	
	potential = {
		exists = planet_owner
		planet_owner = { is_hive_empire = yes }
	}
	
	convert_to = {
		building_acot_dm_ancient_control_center
		building_acot_dm_ancient_palace
	}
	
	allow = {
		num_sapient_pops >= 20
	}
	
	prerequisites = {
		"tech_acot_dm_ancient_hive_cluster"
	}
	
	show_tech_unlock_if = { 
		is_hive_empire = yes
	}
	
	planet_modifier = {
		planet_housing_add = 15
		planet_amenities_add = 80
		planet_max_districts_add = 4
		planet_max_buildings_add = 12
		job_acot_overlord_drone_add = 1
		job_acot_overseer_drone_add = 4
		job_acot_enforcer_drone_add = 2
		planet_orbital_bombardment_damage = -0.10
		pop_environment_tolerance = 0.15
		defense_armies_add = @tier_4_capital_defense_armies
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_technology = tech_capital_productivity_1 }
		}
		modifier = {
			planet_jobs_upkeep_mult = 0.1
			planet_jobs_produces_mult = 0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_technology = tech_capital_productivity_2 }
		}
		modifier = {
			planet_jobs_upkeep_mult = 0.1
			planet_jobs_produces_mult = 0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_technology = tech_capital_productivity_3 }
		}
		modifier = {
			planet_jobs_upkeep_mult = 0.1
			planet_jobs_produces_mult = 0.1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = {
				has_origin = origin_progenitor_hive
			}
			is_planet_class = pc_hive
		}
		job_spawning_drone_add = -1
		job_offspring_drone_add = 1
	}

	resources = {
		category = planet_buildings
		produces = {
			energy = 20
			sr_dark_matter = 10	
			acot_sr_dark_energy = 10
		}
		produces = {
			trigger = {
				is_planet_class = pc_dark_fractured					
			}
			energy = 10
			sr_dark_matter = 5	
			acot_sr_dark_energy = 5
		}
		produces = {
			trigger = {
				is_planet_class = pc_dark_fractured_ae			
			}
			energy = 20
			sr_dark_matter = 10	
			acot_sr_dark_energy = 10
		}
		produces = {
			trigger = {
				is_planet_class = pc_acot_enigmopolis			
			}
			energy = 60
			sr_dark_matter = 30	
			acot_sr_dark_energy = 30
		}
		cost = {
			alloys = 1000
			sr_dark_matter = 100
		}			
	}

	ai_weight = {
		weight = 100
	}
}

###############################################################
# Training Building
###############################################################

building_acot_dm_hospital = {
	base_buildtime = @acot_building_advanced_build_time
	position_priority = 43

	category = amenity
	
	potential = {
		planet_owner = { is_regular_empire = yes }
	}
	
	allow = {
		has_enigmatic_capital = yes
	}
	
	destroy_trigger = {
		planet_owner = { is_regular_empire = no }
	}
	
	planet_modifier = {
		job_acot_apothecary_add = 2
		pop_happiness = 0.2
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_gene_tailoring
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 4
		}
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_origin = origin_overtuned
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 4
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_basic_alloy_cost
			sr_dark_matter = @acot_building_basic_dm_cost
			acot_sr_dark_energy = @acot_building_basic_de_cost
		}
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 2
			acot_sr_dark_energy = 2
		}
	}
	
	prerequisites = {
		"tech_acot_dm_hospital"
	}
	
	show_tech_unlock_if = {
		is_regular_empire = yes
	}
	
	ai_weight = {
		weight = 10

		modifier = {
			factor = 5
			free_amenities < 2
		}
		# There are already unworked jobs
		# Blocks buildings unworkable by remaining pops (slaves/robots etc)
		# Will be improved... at some point
		modifier = {
			factor = 0
			free_jobs > 0 
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = sr_dark_matter
					value <= 3
				}
			}
		}
	}

	upgrades = {
		building_acot_ae_hospital
	}
}

building_acot_dm_hive_pool = {
	base_buildtime = 450
	position_priority = 44

	category = amenity
	
	potential = {
		planet_owner = { is_hive_empire = yes }
	}
	
	allow = {
		has_enigmatic_capital = yes
	}

	destroy_trigger = {
		planet_owner = { is_hive_empire = no }
	}
	
	triggered_planet_modifier = {
		potential = {
			NAND = {
				exists = planet_owner
				planet_owner = { has_origin = origin_progenitor_hive }
			}
		}
		job_acot_broodmother_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { has_origin = origin_progenitor_hive }
		}
		job_acot_offspring_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_gene_tailoring
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 4
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_origin = origin_overtuned
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 4
		}
	}

	prerequisites = { tech_acot_dm_hive_depot }
	
	resources = {
		category = planet_buildings
		cost = {
			alloys = 500
			acot_sr_dark_energy = 100
		}
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			energy = 2
			acot_sr_dark_energy = 2
		}
	}

	ai_weight = {
		weight = 100

		modifier = {
			factor = 5
			free_amenities < 2
		}
		modifier = {
			factor = 0
			OR = {
				has_building = building_acot_dm_hive_pool
				has_building = building_acot_ae_hive_pool				
			}
		}
	}

	upgrades = {
		building_acot_ae_hive_pool
	}
}

building_acot_dm_super_assembly = {
	base_buildtime = @acot_building_advanced_build_time
	category = pop_assembly
	position_priority = 45
	
	allow = {
		has_enigmatic_capital = yes
	}

	potential = {
		exists = owner
		OR = {
			owner = { is_ai = no }
			NOT = { exists = assembling_species }
			assembling_species = { is_robotic_species = yes }
		}
		owner = {
			is_regular_empire = yes
			is_individual_machine = no
			NOT = { has_policy_flag = robots_outlawed }
			OR = {
				is_ai = no
				has_genetic_ascension = no
				is_materialist = yes
			}
		}
		NOR = {
			has_modifier = slave_colony
			has_modifier = resort_colony
		}
	}

	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				OR = {
					is_regular_empire = no
					has_policy_flag = robots_outlawed
				}
			}
			has_modifier = slave_colony
			AND = {
				owner = { is_ai = yes }
				free_district_slots = 0
				free_building_slots = 0
				free_housing <= 0
				free_jobs <= 0
			}
			owner = {
				is_ai = yes
				has_genetic_ascension = yes
				is_materialist = no
			}
		}
	}

	convert_to = {
		building_acot_dm_super_assembly_machine
	}

	planet_modifier = {
		job_acot_roboman_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				OR = {
					has_origin = origin_mechanists
					is_individual_machine = yes
					has_country_flag = synthetic_empire
				}
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 4
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			alloys = 800
			sr_dark_matter = 300
			acot_sr_dark_energy = 150
		}
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 2
			acot_sr_dark_energy = 2
		}
	}
	
	prerequisites = {
		"tech_acot_dm_super_assembly"
	}
	
	ai_weight = {
		weight = 10
		modifier = {
			factor = 0
			OR = {
				num_buildings = {
					type = building_acot_dm_super_assembly
					value >= 1		
				}	
				num_buildings = {
					type = building_acot_ae_super_assembly
					value >= 1		
				}				
			}
		}
	}

	upgrades = {
		building_acot_ae_super_assembly
	}
}

building_acot_dm_super_assembly_machine = {
	icon = building_acot_dm_super_assembly
	base_buildtime = @acot_building_advanced_build_time
	position_priority = 46

	category = pop_assembly
	
	potential = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = yes
				is_individual_machine = yes
			}
		}
		NOT = { has_modifier = gestation_colony }
	}

	convert_to = {
		building_acot_dm_super_assembly
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_machine_empire = yes
			}
		}
		job_acot_robodrone_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				is_individual_machine = yes
			}
		}
		job_acot_roboman_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				OR = {
					is_machine_empire = yes
					is_individual_machine = yes
				}
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 4
		}
	}

	allow = {
		has_enigmatic_capital = yes
	}

	prerequisites = {
		"tech_acot_dm_super_assembly"
	}

	resources = {
		category = planet_buildings
		cost = {
			alloys = 800
			sr_dark_matter = 300
			acot_sr_dark_energy = 150
		}
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 2
			acot_sr_dark_energy = 2
		}
	}
	
	upgrades = {
		building_acot_ae_super_assembly_machine
	}
	
	ai_weight = {
		weight = 10
		modifier = {
			factor = 0
			OR = {
				num_buildings = {
					type = building_acot_dm_super_assembly_machine
					value >= 1		
				}	
				num_buildings = {
					type = building_acot_ae_super_assembly_machine
					value >= 1		
				}				
			}
		}
	}
}

### SOECIAL POP BUILDINGER

# Biological path
building_acot_dm_clone_vats = {
	base_buildtime = @acot_building_advanced_build_time
	position_priority = 47

	category = government

	prerequisites = {
		tech_acot_dm_clone_vats
	}

	potential = {
		exists = owner
		owner = { has_tradition = tr_genetics_adopt }
		NOT = { has_modifier = resort_colony }
		OR = {
			owner = { is_ai = no }
			NOT = { exists = assembling_species }
			assembling_species = { is_organic_species = yes }
		}
		OR = {
			owner = { is_ai = no }
			NAND = {
				free_district_slots = 0
				free_building_slots <= 1
				free_housing <= 0
				free_jobs <= 0
			}
		}
	}

	destroy_trigger = {
		exists = owner
		OR = {
			AND = {
				owner = { is_ai = yes }
				free_district_slots = 0
				free_building_slots = 0
				free_housing <= 0
				free_jobs <= 0
			}
			NOT = { owner = { has_tradition = tr_genetics_adopt } }
		}
	}

	planet_modifier = {
		planet_pop_assembly_organic_add = 10
		pop_growth_speed = 1.00
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_technology = tech_gene_tailoring
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 4
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = owner
			owner = {
				has_origin = origin_overtuned
			}
			any_owned_pop = {
				has_auto_modding_trait = yes
			}
		}
		modifier = {
			auto_mod_monthly_add = 4
		}
	}

	allow = {
		has_enigmatic_capital = yes
	}

	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_basic_alloy_cost
			sr_dark_matter = @acot_building_basic_dm_cost
			acot_sr_dark_energy = @acot_building_basic_de_cost
		}	
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 2
			acot_sr_dark_energy = 2
		}
		upkeep = {
			trigger = {
				exists = owner
				owner = { is_lithoid_empire = no }
			}
			food = 10
		}
		upkeep = {
			trigger = {
				exists = owner
				owner = { is_lithoid_empire = yes }
			}
			minerals = 10
		}
	}

	upgrades = {
		building_acot_ae_clone_vats
	}

	ai_weight = {
		weight = 10000
		modifier = {
			factor = 0
			OR = {
				has_building = building_acot_dm_clone_vats	
				has_building = building_acot_ae_clone_vats	
			}
		}
	}
}

# Synth path
building_acot_dm_synt_center = {
	base_buildtime = 360
	position_priority = 48

	category = government

	planet_modifier = {
		planet_jobs_specialist_produces_mult = 0.10
	}

	triggered_planet_modifier = {
		potential = {
			num_sapient_pops >= 50
		}
		planet_jobs_specialist_produces_mult = 0.10
	}

	triggered_planet_modifier = {
		potential = {
			num_sapient_pops >= 100
		}
		planet_jobs_specialist_produces_mult = 0.10
	}

	triggered_planet_modifier = {
		potential = {
			num_sapient_pops >= 150
		}
		planet_jobs_specialist_produces_mult = 0.10
	}

	triggered_planet_modifier = {
		potential = {
			num_sapient_pops >= 200
		}
		planet_jobs_specialist_produces_mult = 0.10
	}

	allow = {
		has_enigmatic_capital = yes
	}

	resources = {
		category = planet_buildings
		produces = {
			engineering_research = 5
		}
		cost = {
			alloys = 250
			sr_dark_matter = 100	
			acot_sr_dark_energy = 100
		}	
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 5
			acot_sr_dark_energy = 5
		}
	}

	upgrades = {
		building_acot_ae_synt_center
	}
	
	prerequisites = {
		tech_acot_dm_synt_center
	}

	ai_weight = {
		weight = 10000
		modifier = {
			factor = 0
			OR = {
				has_building = building_acot_dm_synt_center	
				has_building = building_acot_ae_synt_center	
			}
		}
	}
}

# PSIONOIDE path

building_acot_dm_psi_altar = {
	base_buildtime = 360
	position_priority = 49

	category = government

	planet_modifier = {
		pop_growth_speed = 0.25
	}

	allow = {
		has_enigmatic_capital = yes
	}

	resources = {
		category = planet_buildings
		produces = {
			sr_zro = 5
			unity = 25
		}
		cost = {
			alloys = 250
			sr_dark_matter = 100	
			acot_sr_dark_energy = 100
		}	
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 5
			acot_sr_dark_energy = 5
		}
	}

	upgrades = {
		building_acot_ae_psi_altar
	}
	
	prerequisites = {
		tech_acot_dm_psi_altar
	}

	ai_weight = {
		weight = 10000
		modifier = {
			factor = 0
			OR = {
				has_building = building_acot_dm_psi_altar	
				has_building = building_acot_ae_psi_altar	
			}
		}
	}
}

# Machine path

building_acot_dm_machine_dome = {
	base_buildtime = 360
	position_priority = 50

	category = government

	planet_modifier = {
		planet_jobs_complex_drone_produces_mult = 0.05
		planet_jobs_simple_drone_produces_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			num_sapient_pops >= 50
		}
		planet_jobs_complex_drone_produces_mult = 0.05
		planet_jobs_simple_drone_produces_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			num_sapient_pops >= 100
		}
		planet_jobs_complex_drone_produces_mult = 0.05
		planet_jobs_simple_drone_produces_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			num_sapient_pops >= 150
		}
		planet_jobs_complex_drone_produces_mult = 0.05
		planet_jobs_simple_drone_produces_mult = 0.05
	}

	triggered_planet_modifier = {
		potential = {
			num_sapient_pops >= 200
		}
		planet_jobs_complex_drone_produces_mult = 0.05
		planet_jobs_simple_drone_produces_mult = 0.05
	}

	allow = {
		has_enigmatic_capital = yes
	}

	resources = {
		category = planet_buildings
		produces = {
		}
		cost = {
			alloys = 250
			sr_dark_matter = 100	
			acot_sr_dark_energy = 100
		}	
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 5
			acot_sr_dark_energy = 5
		}
	}

	upgrades = {
		building_acot_ae_machine_dome
	}
	
	prerequisites = {
		tech_acot_dm_machine_dome
	}

	ai_weight = {
		weight = 10000
		modifier = {
			factor = 0
			OR = {
				has_building = building_acot_dm_machine_dome	
				has_building = building_acot_ae_machine_dome	
			}
		}
	}
}

#### HIVE PATHOS

building_acot_dm_hive_evochamber = {
	base_buildtime = 360
	position_priority = 51

	category = government

	planet_modifier = {
		pop_growth_speed = 0.50
	}

	allow = {
		has_enigmatic_capital = yes
	}

	resources = {
		category = planet_buildings
		produces = {
			society_research = 25
			food = 50
		}
		cost = {
			alloys = 250
			sr_dark_matter = 100	
			acot_sr_dark_energy = 100
		}	
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 5
			acot_sr_dark_energy = 5
		}
	}

	upgrades = {
		building_acot_ae_hive_evochamber
	}
	
	prerequisites = {
		tech_acot_dm_hive_evochamber
	}

	ai_weight = {
		weight = 10000
		modifier = {
			factor = 0
			OR = {
				has_building = building_acot_dm_hive_evochamber	
				has_building = building_acot_ae_hive_evochamber	
			}
		}
	}
}

###############################################################
# Resource Building
###############################################################

#########################  DM AND DE  ######################################

building_acot_dm_dark_energy_pylon = {
	base_buildtime = @acot_building_basic_build_time
	can_demolish = yes
	can_be_disabled = yes
	position_priority = 52

	category = manufacturing
	
	potential = {
	}
	
	allow = {
		has_major_upgraded_capital = yes
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = no }					
		}
		modifier = {
			job_acot_dark_energy_man_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = no }		
			has_enigmatic_capital = yes			
		}
		modifier = {
			job_acot_dark_energy_man_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }					
		}
		modifier = {
			job_acot_dark_energy_drone_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }	
			has_enigmatic_capital = yes				
		}
		modifier = {
			job_acot_dark_energy_drone_add = 1
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			alloys = 400
		}
		produces = {
			trigger = {
				planet_owner = { is_ai = yes }
			}
			acot_sr_dark_energy = 4
		}
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			energy = 4
		}
	}
	
	prerequisites = {
		"tech_acot_dm_dark_energy_pylon"
	}
	
	ai_weight = {
		weight = 10
		modifier = {
			factor = 100000	
			planet_owner = {
				has_monthly_income = {
					resource = acot_sr_dark_energy
					value < 3
				}
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = acot_sr_dark_energy
					value > 250
				}
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = energy
					value <= 10
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				num_buildings = {
					type = building_acot_dm_dark_energy_pylon
					value >= 2
				}	
				num_buildings = {
					type = building_acot_ae_dark_energy_pylon
					value >= 2
				}		
			}
		}
	}

	upgrades = {
		building_acot_ae_dark_energy_pylon
	}
}

building_acot_dm_dark_matter_generator = {
	base_buildtime = @acot_building_basic_build_time
	can_demolish = yes
	can_be_disabled = yes
	position_priority = 53

	category = manufacturing
	
	potential = {
	}
	
	allow = {
		has_major_upgraded_capital = yes
	}
##########################	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = no }					
		}
		modifier = {
			job_acot_dark_matter_man_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = no }	
			has_enigmatic_capital = yes						
		}
		modifier = {
			job_acot_dark_matter_man_add = 1
		}
	}
##########################
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }					
		}
		modifier = {
			job_acot_dark_matter_drone_add = 1
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }		
			has_enigmatic_capital = yes					
		}
		modifier = {
			job_acot_dark_matter_drone_add = 1
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			alloys = 400
		}
		produces = {
			trigger = {
				planet_owner = { is_ai = yes }
			}
			sr_dark_matter = 4
		}
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			energy = 4
		}
	}
	
	prerequisites = {
		"tech_acot_dm_dark_matter_generator"
	}
	
	ai_weight = {
		weight = 5
		modifier = {
			factor = 10000
			planet_owner = {
				has_monthly_income = {
					resource = sr_dark_matter
					value < 5
				}
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = sr_dark_matter
					value > 250
				}
			}
		}
		modifier = {
			factor = 0
			OR = {
				num_buildings = {
					type = building_acot_dm_dark_matter_generator
					value >= 3
				}	
				num_buildings = {
					type = building_acot_ae_dark_matter_generator
					value >= 3
				}		
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = minerals
					value <= 10
				}
			}
		}
	}

	upgrades = {
		building_acot_ae_dark_matter_generator
	}
}

building_acot_dm_dark_matter_synthersizer = {
	base_buildtime = 600
	position_priority = 54

	category = manufacturing

	potential = {
	}
	
	country_modifier = {
		country_resource_max_acot_sr_dark_energy_add = 10000
		country_resource_max_sr_dark_matter_add = 10000		
	}

	allow = {
		has_enigmatic_capital = yes
	}

	resources = {
		category = planet_buildings
		cost = {
			alloys = 1000
		}
		produces = {
			sr_dark_matter = 10
			acot_sr_dark_energy = 10
		}

		#### DE

		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_dm_dark_energy_pylon
					value = 2
				}
			}
			acot_sr_dark_energy = 10
		}
		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_dm_dark_energy_pylon
					value = 3
				}
			}
			acot_sr_dark_energy = 20
		}
		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_dm_dark_energy_pylon
					value >= 4
				}
			}
			acot_sr_dark_energy = 30
		}

		##### A DE

		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_ae_dark_energy_pylon
					value = 2
				}
			}
			acot_sr_dark_energy = 15
		}
		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_ae_dark_energy_pylon
					value = 3
				}
			}
			acot_sr_dark_energy = 25
		}
		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_ae_dark_energy_pylon
					value >= 4
				}
			}
			acot_sr_dark_energy = 35
		}

		##### DM

		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_dm_dark_matter_generator
					value = 2
				}
			}
			sr_dark_matter = 10
		}
		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_dm_dark_matter_generator
					value = 3
				}
			}
			sr_dark_matter = 20
		}
		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_dm_dark_matter_generator
					value >= 4
				}
			}
			sr_dark_matter = 30
		}	
		
		##### A DM

		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_ae_dark_matter_generator
					value = 2
				}
			}
			sr_dark_matter = 15
		}
		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_ae_dark_matter_generator
					value = 3
				}
			}
			sr_dark_matter = 25
		}
		produces = {
			trigger = {
				num_buildings = {
					type = building_acot_ae_dark_matter_generator
					value >= 4
				}
			}
			sr_dark_matter = 35
		}	

		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			energy = 10
		}
	}
	
	prerequisites = {
		"tech_acot_dm_dark_matter_synthersizer"
	}
	
	ai_weight = {
		weight = 20000
	}

	ai_resource_production = {
		sr_dark_matter = 50
		acot_sr_dark_energy = 50
		trigger = {
			always = yes
		}
	}

	upgrades = {
		building_acot_ae_dark_matter_synthersizer
	}
}

#########################  VANILLA RESOURCES  ######################################

########## AMPLIFIER

building_acot_dm_district_amplifier = {
	base_buildtime = @acot_building_basic_build_time
	category = resource
	position_priority = 55

	allow = {
		has_enigmatic_capital = yes
	}

	country_modifier = {
		country_resource_max_energy_add = 50000
		country_resource_max_minerals_add = 50000
		country_resource_max_food_add = 50000
	}

	planet_modifier = {
		planet_technician_energy_produces_add = 4
		planet_miners_minerals_produces_add = 4
		planet_farmers_food_produces_add = 4
		district_farming_max = 2
		district_mining_max = 2
		district_generator_max = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_regular_empire = yes }
		}
		modifier = {
			job_acot_workerman_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }
		}
		modifier = {
			job_acot_workerdrone_add = 1
		}
	}
	
	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_pleb_basic_alloy_cost
			sr_dark_matter = @acot_building_pleb_basic_dm_cost	
			acot_sr_dark_energy = @acot_building_pleb_basic_de_cost
		}
	}	
	
	prerequisites = {
		tech_acot_dm_district_amplifier
	}
	
	
	ai_weight = {
		weight = 3000
		modifier = {
			factor = 5
			OR = {
				num_districts = {
					type = district_generator
					value >= 4
				}
				num_districts = {
					type = district_mining
					value >= 4
				}
				num_districts = {
					type = district_farming
					value >= 4
				}
			}
		}
	}

	ai_resource_production = {
		energy = 10
		food = 10
		minerals = 10
		trigger = {
			always = yes
		}
	}

	upgrades = {
		building_acot_ae_district_amplifier
	}
}

building_acot_dm_alloygood_amplifier = {
	base_buildtime = @acot_building_basic_build_time
	category = resource
	position_priority = 56

	allow = {
		has_enigmatic_capital = yes
	}

	country_modifier = {
		country_resource_max_alloys_add = 50000
		country_resource_max_consumer_goods_add = 50000
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_catalytic_empire = no }			
		}
		planet_metallurgists_alloys_produces_add = 2
		planet_metallurgists_minerals_upkeep_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_catalytic_empire = yes 
				is_machine_empire = no
			}			
		}
		planet_metallurgists_alloys_produces_add = 2.25
		planet_metallurgists_food_upkeep_add = 3
	}	

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_catalytic_empire = yes 
				is_machine_empire = yes
			}			
		}
		planet_metallurgists_alloys_produces_add = 4
		planet_metallurgists_food_upkeep_add = 5
	}	

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = {  country_uses_consumer_goods = yes }		
		}
		planet_artisans_consumer_goods_produces_add = 6
		planet_artisans_minerals_upkeep_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { country_uses_consumer_goods = no }		
		}
		planet_metallurgists_alloys_produces_add = 2
		planet_metallurgists_minerals_upkeep_add = 2
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_regular_empire = yes }
		}
		modifier = {
			job_acot_specialman_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }
		}
		modifier = {
			job_acot_specialdrone_add = 1
		}
	}
	
	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_basic_alloy_cost
			sr_dark_matter = @acot_building_basic_dm_cost	
			acot_sr_dark_energy = @acot_building_basic_de_cost
		}
	}	
	
	prerequisites = {
		tech_acot_dm_alloygood_amplifier
	}
	
	
	ai_weight = {
		weight = 3000
	}

	ai_resource_production = {
		trigger = {
			always = yes
		}
	}

	upgrades = {
		building_acot_ae_alloygood_amplifier
	}
}

#####################

building_acot_dm_mineral_processing_plant = {
	base_buildtime = @acot_building_basic_build_time
	#
	category = resource
	position_priority = 57

	allow = {
		has_enigmatic_capital = yes
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_regular_empire = yes }
		}
		modifier = {
			job_acot_mineralman_add = 2
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }
		}
		modifier = {
			job_acot_mineraldrone_add = 2
		}
	}
	
	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_pleb_basic_alloy_cost
			sr_dark_matter = @acot_building_pleb_basic_dm_cost	
			acot_sr_dark_energy = @acot_building_pleb_basic_de_cost
		}
		produces = {
			minerals = 50
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			minerals = 20
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			sr_dark_matter = 0.5
			acot_sr_dark_energy = 0.5
		}
	}
	
	prerequisites = {
		tech_acot_dm_mineral_processing_plant
	}
	
	ai_weight = {
		weight = 2000
		modifier = {
			factor = 5
			planet_owner = { 
				has_monthly_income = {
					resource = minerals
					value < 5
				}
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = energy
					value < 5
				}
			}
		}
	}

	ai_resource_production = {
		minerals = 10
		trigger = {
			always = yes
		}
	}

	upgrades = {
		building_acot_ae_mineral_processing_plant
	}
}

########## ENERGY NEXOUS

building_acot_dm_power_hub = {
	base_buildtime = @acot_building_basic_build_time
	#
	category = resource
	position_priority = 58

	allow = {
		has_enigmatic_capital = yes
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_regular_empire = yes }
		}
		modifier = {
			job_acot_energyman_add = 2
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }
		}
		modifier = {
			job_acot_energydrone_add = 2
		}
	}
	
	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_pleb_basic_alloy_cost
			sr_dark_matter = @acot_building_pleb_basic_dm_cost	
			acot_sr_dark_energy = @acot_building_pleb_basic_de_cost
		}
		produces = {
			energy = 50
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			energy = 20
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			acot_sr_dark_energy = 0.5
			sr_dark_matter = 0.5
		}
	}	
	
	prerequisites = {
		tech_acot_dm_power_hub
	}
	
	
	ai_weight = {
		weight = 3000
		modifier = {
			factor = 5
			planet_owner = { 
				has_monthly_income = {
					resource = energy
					value < 10
				}
			}
		}
		# There are already unworked jobs
		# Blocks buildings unworkable by remaining pops (slaves/robots etc)
		# Will be improved... at some point
		modifier = {
			factor = 0
			free_jobs > 0 
		}
	}

	ai_resource_production = {
		energy = 10
		trigger = {
			always = yes
		}
	}

	upgrades = {
		building_acot_ae_power_hub
	}
}

### FOOOD FIDDLEEE ###

building_acot_dm_food_processing_complex = {
	base_buildtime = @acot_building_basic_build_time
	#
	category = resource
	position_priority = 59

	allow = {
		has_enigmatic_capital = yes
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_regular_empire = yes }
		}
		modifier = {
			job_acot_foodman_add = 2
		}
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }
		}
		modifier = {
			job_acot_fooddrone_add = 2
		}
	}
	
	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_pleb_basic_alloy_cost
			sr_dark_matter = @acot_building_pleb_basic_dm_cost	
			acot_sr_dark_energy = @acot_building_pleb_basic_de_cost
		}
		produces = {
			food = 50
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			food = 20
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			acot_sr_dark_energy = 0.5
			sr_dark_matter = 0.5
		}
	}	

	prerequisites = {
		"tech_acot_dm_food_processing"
	}	
	
	ai_weight = {
		weight = 2
		modifier = {
			factor = 5
			planet_owner = { 
				has_monthly_income = {
					resource = food
					value < 5
				}
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				OR = {
					is_mechanical_empire = no
					AND = {
						is_mechanical_empire = yes
						OR = {
							has_civic = civic_machine_servitor
							has_civic = civic_machine_assimilator
						}
					}
				}
				has_monthly_income = {
					resource = energy
					value < 5
				}
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				is_mechanical_empire = yes
				NOR = {
					has_civic = civic_machine_servitor
					has_civic = civic_machine_assimilator
				}
			}
		}
	}

	ai_resource_production = {
		food = 10
		trigger = {
			always = yes
		}
	}

	upgrades = {
		building_acot_ae_food_processing_complex
	}
}

### SUMER GOODS

building_acot_dm_factory = {
	base_buildtime = @acot_building_basic_build_time
	position_priority = 60
	#

	category = manufacturing

	allow = {
		has_enigmatic_capital = yes
	}
	
	potential = {
		planet_owner = {
			OR = {
				is_gestalt = no
				has_valid_civic = civic_machine_servitor
			}
		}		
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_regular_empire = yes }
		}
		modifier = {
			job_acot_artisan_add = 2
		}
	}	
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }
		}
		modifier = {
			job_acot_artisan_add = 2
		}
	}	
	
	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_basic_alloy_cost
			sr_dark_matter = @acot_building_basic_dm_cost	
			acot_sr_dark_energy = @acot_building_basic_de_cost
		}
		produces = {
			consumer_goods = 25
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			consumer_goods = 20
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			sr_dark_matter = 1
			acot_sr_dark_energy = 1
			minerals = 10	
		}
	}	
	
	prerequisites = {
		tech_acot_dm_factory
	}
	
	ai_weight = {
		weight = 2
		modifier = {
			factor = 5
			planet_owner = { 
				has_monthly_income = {
					resource = consumer_goods
					value < 5
				}
				has_monthly_income = {
					resource = minerals
					value > 6
				}
			}
		}
		# There are already unworked jobs
		# Blocks buildings unworkable by remaining pops (slaves/robots etc)
		# Will be improved... at some point
		modifier = {
			factor = 0
			free_jobs > 0 
		}
	}

	ai_resource_production = {
		consumer_goods = 10
		trigger = {
			always = yes
		}
	}

	upgrades = {
		building_acot_ae_factory
	}
}

building_acot_dm_alloy_forge = {
	base_buildtime = @acot_building_basic_build_time
	position_priority = 61
	#

	category = manufacturing
	
	allow = {
		has_enigmatic_capital = yes
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_hive_empire = yes }
		}
		modifier = {
			job_acot_alloydrone_add = 2
		}
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_machine_empire = yes }
		}
		modifier = {
			job_acot_alloydrone_add = 2
		}
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_regular_empire = yes }
		}
		modifier = {
			job_acot_alloyman_add = 2
		}
	}
	
	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_basic_alloy_cost
			sr_dark_matter = @acot_building_basic_dm_cost	
			acot_sr_dark_energy = @acot_building_basic_de_cost
		}
		produces = {
			alloys = 25
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			alloys = 10
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			minerals = 10
			sr_dark_matter = 1
			acot_sr_dark_energy = 1
		}
	}

	prerequisites = {
		tech_acot_dm_alloy_foundry
	}	
	
	ai_weight = {
		weight = 100000
		modifier = {
			factor = 0
			OR = {
				num_buildings = {
					type = building_acot_dm_alloy_forge
					value >= 3
				}
				num_buildings = {
					type = building_acot_ae_alloy_forge
					value >= 3
				}				
			}
		}
		modifier = {
			factor = 50
			planet_owner = { 
				has_monthly_income = {
					resource = alloys
					value < 5
				}
			}
		}
		modifier = {
			factor = 0
			planet_owner = { 
				has_monthly_income = {
					resource = sr_dark_matter
					value <= 2
				}
			}
		}
		# There are already unworked jobs
		# Blocks buildings unworkable by remaining pops (slaves/robots etc)
		# Will be improved... at some point
		modifier = {
			factor = 0
			free_jobs > 0 
		}
	}

	ai_resource_production = {
		alloys = 10
		trigger = {
			always = yes
		}
	}

	upgrades = {
		building_acot_ae_alloy_forge
	}
}

building_acot_dm_transmutor = {
	base_buildtime = @acot_building_basic_build_time
	position_priority = 62
	#

	category = manufacturing
	
	potential = {
	}
	
	allow = {
		has_enigmatic_capital = yes
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = no }					
		}
		modifier = {
			job_acot_transmute_man_add = 2
		}
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }					
		}
		modifier = {
			job_acot_transmute_drone_add = 2
		}
	}
	
	resources = {
		category = planet_buildings
		cost = {
			alloys = @acot_building_basic_alloy_cost
			sr_dark_matter = @acot_building_basic_dm_cost	
			acot_sr_dark_energy = @acot_building_basic_de_cost
		}	
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_rare_crystals
				}
			}
			rare_crystals = 6
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_volatile_motes
				}
			}
			volatile_motes = 6
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_exotic_gases
				}
			}
			exotic_gases = 6
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_mine_living_metal
				}
			}
			sr_living_metal = 3
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_nanite_transmutation
				}
			}
			nanites = 3
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_mine_zro
				}
			}
			sr_zro = 3
		}

		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_rare_crystals
				}
			}
			acot_sr_dark_energy = 1
			sr_dark_matter = 1
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_volatile_motes
				}
			}
			acot_sr_dark_energy = 1
			sr_dark_matter = 1
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_exotic_gases
				}
			}
			acot_sr_dark_energy = 1
			sr_dark_matter = 1
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_mine_living_metal
				}
			}
			acot_sr_dark_energy = 1
			sr_dark_matter = 1
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_nanite_transmutation
				}
			}
			acot_sr_dark_energy = 1
			sr_dark_matter = 1
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
				planet_owner = {
					has_technology = tech_mine_zro
				}
			}
			acot_sr_dark_energy = 1
			sr_dark_matter = 1
		}
	}	
	
	prerequisites = {
		"tech_acot_dm_transmutor"
	}
	
	ai_weight = {
		weight = 20000
		modifier = {
			factor = 5000
			planet_owner = { 
				OR = {
					has_monthly_income = {
						resource = rare_crystals
						value < 2
					}			
					has_monthly_income = {
						resource = exotic_gases
						value < 2
					}	
					has_monthly_income = {
						resource = volatile_motes
						value < 2
					}		
				}
			}
		}
		modifier = {
			factor = 0
			num_buildings = { type = building_acot_dm_transmutor value >= 1 }
		}
		# There are already unworked jobs
		# Blocks buildings unworkable by remaining pops (slaves/robots etc)
		# Will be improved... at some point
		modifier = {
			factor = 0
			free_jobs > 0 
		}
	}

	ai_resource_production = {
		volatile_motes = 10
		exotic_gases = 10
		rare_crystals = 10
		trigger = {
			always = yes
		}
	}

	upgrades = {
		building_acot_ae_transmutor	
	}
}

###############################################################
# Research Building
###############################################################

building_acot_dm_enigmatic_lab = {
	base_buildtime = 680
	can_demolish = yes
	can_be_disabled = yes
	position_priority = 63

	category = research
	
	allow = {
		has_enigmatic_capital = yes
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_regular_empire = yes 
			}
		}
		modifier = {
			job_acot_researcher_add = 2
		}
	}	
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }
		}
		modifier = {
			job_acot_researcher_drone_add = 2
		}
	}	

	resources = {
		category = planet_buildings
		cost = {
			minerals = 600
			sr_dark_matter = 200
			acot_sr_dark_energy = 100
		}
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			physics_research = 12
			engineering_research = 12
			society_research = 12
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			sr_dark_matter = 3
			acot_sr_dark_energy = 3
		}
	}
	prerequisites = {
		"tech_acot_dm_enigmatic_lab"
	}

	
	ai_weight = {
		weight = 50
		modifier = {
			factor = 5000000
			num_buildings = {
				type = building_acot_dm_enigmatic_lab
				value <= 1
			}
		}
		modifier = {
			factor = 0
			OR = {
				num_buildings = {
					type = building_acot_dm_enigmatic_lab
					value >= 3
				}
				num_buildings = {
					type = building_acot_ae_enigmatic_lab
					value >= 3
				}				
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = sr_dark_matter
					value <= 3
				}
			}	
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = energy
					value <= 10
				}
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = consumer_goods
					value <= 10
				}
			}
		}
	}
	
	upgrades = {
		building_acot_ae_enigmatic_lab
	}
}

building_acot_dm_institute = {
	base_buildtime = 520
	position_priority = 64

	category = research

	allow = {
		has_enigmatic_capital = yes
	}

	resources = {
		category = planet_buildings
		produces = {
			physics_research = 100
			engineering_research = 100
			society_research = 100
			minor_artifacts = 5
		}
		cost = {
			alloys = 800
			sr_dark_matter = 300
			acot_sr_dark_energy = 150
		}
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 25
			acot_sr_dark_energy = 25
		}
	}

	country_modifier = {
		country_scientist_cap_add = 1
		physics_tech_cost_mult = -0.10
		society_tech_cost_mult = -0.10
		engineering_tech_cost_mult = -0.10
		all_technology_research_speed = 0.2
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_regular_empire = yes 
			}
		}
		modifier = {
			job_acot_researcher_add = 2
		}
	}	
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }
		}
		modifier = {
			job_acot_researcher_drone_add = 2
		}
	}	

	prerequisites = {
		"tech_acot_dm_institute"
	}
	
	show_tech_unlock_if = { 
	}
	
	ai_weight = {
		weight = 1000
		# There are already unworked jobs
		# Blocks buildings unworkable by remaining pops (slaves/robots etc)
		# Will be improved... at some point
		modifier = {
			factor = 0
			free_jobs > 0 
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = energy
					value <= 10
				}
			}
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = sr_dark_matter
					value <= 3
				}
			}	
		}
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = acot_sr_dark_energy
					value <= 3
				}
			}	
		}
	}

	upgrades = {
		building_acot_ae_institute
	}
}

###############################################################
# Misc Building
###############################################################

building_acot_dm_psg = {
	base_buildtime = 600
	position_priority = 100

	category = army
	
	allow = {
		has_enigmatic_capital = yes
		acot_has_shield_building = no
	}
	
	planet_modifier = {
		planet_orbital_bombardment_damage = -0.70
	}

	resources = {
		category = planet_buildings
		cost = {
			alloys = 1000 
			sr_dark_matter = 400
			acot_sr_dark_energy = 200
		}			
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 5
			acot_sr_dark_energy = 5
		}
	}
	
	prerequisites = {
		"tech_acot_dm_psg"
	}
	
	ai_weight = {
		weight = 15000
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = acot_sr_dark_energy
					value <= 3
				}
			}
		}
	}

	upgrades = {
		building_acot_ae_psg
	}
}

###############################################################
# Defense Buildings
###############################################################

building_acot_dm_stronghold = {
	base_buildtime = 400
	planetary_ftl_inhibitor = yes
	position_priority = 100

	upgrades = {
		building_acot_ae_stronghold
	}

	category = army
	
	allow = {
		has_enigmatic_capital = yes
	}
	
	planet_modifier = {
		planet_housing_add = 5
	}
	
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_fallen_empire = no
				is_gestalt = no 
			}
		}
		modifier = {
			job_acot_soldier_add = 2
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_fallen_empire = no
				is_gestalt = yes 
			}
		}
		modifier = {
			job_acot_soldier_drone_add = 2
		}
	}
	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { 
				is_fallen_empire = yes
			}
		}
		modifier = {
			job_fe_protector_add = 3
		}
	}

	resources = {
		category = planet_buildings
		cost = {
			alloys = 400
			sr_dark_matter = 250
			acot_sr_dark_energy = 125
		}			
		upkeep = {
			trigger = { planet_owner = { NOT = { has_technology = tech_acot_fractured_autoharvesting } } }
			sr_dark_matter = 2
			acot_sr_dark_energy = 2
		}
	}
	
	prerequisites = {
		"tech_acot_dm_stronghold"
	}
	
	ai_weight = {
		weight = 0
		modifier = {
			weight = 100000
			num_sapient_pops >= 40
			NOR = {
				OR = {
					num_buildings = {
						type = building_acot_dm_stronghold
						value <= 1
					}
					num_buildings = {
						type = building_acot_ae_stronghold
						value <= 1
					}					
				}
			}
			planet_owner = {
				has_monthly_income = {
					resource = sr_dark_matter
					value <= 3
				}
			}
		}
	}
}

building_acot_giga_fortress = {
	base_buildtime = 1200
	can_be_ruined = no
	can_be_disabled = no
	position_priority = 100

	planetary_ftl_inhibitor = yes

	category = army
	
	allow = {
		has_enigmatic_capital = yes
	}

	on_built = {
		if = {
			limit = {
				NOT = {
					any_planet_army = {
						army_type = acot_garrison_army_giga
					}
				}
			}
			create_army = {
				owner = planet_owner
				type = acot_garrison_army_giga
			}
		}
	}

	on_destroy = {
		if = {
			limit = {
				has_giga_fort = no
			}
			every_planet_army = {
				limit = {
					army_type = acot_garrison_army_giga
				}
				remove_army = yes
			}
		}
	}
	
	country_modifier = {
		country_naval_cap_add = 100
	}

	planet_modifier = {
		planet_amenities_add = 20
		planet_housing_add = 20
		planet_stability_add = 50
	}

	triggered_planet_modifier = {
		potential = {
			has_ground_combat = yes
		}
		pop_defense_armies_add = 1
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = no }
		}
		job_acot_giga_fortress_operator_add = 3	
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = { is_gestalt = yes }
		}
		job_acot_giga_fortress_operator_drone_add = 3	
	}

	triggered_planet_modifier = {
		potential = {
			exists = planet_owner
			planet_owner = {
				is_fallen_empire = yes
			}
		 }
		 job_acot_giga_fortress_operator_ancient_add = 3
	}

	army_modifier = {
		army_defense_morale_mult = 5
		army_defense_health_mult = 2	
		army_defense_damage_mult = 2
	}

	resources = {
		category = planet_buildings
		produces = {
			unity = 50
			energy = 50
		}
		produces = {
			trigger = {
				planet_owner = {
					country_uses_food = yes
				}
			}
			food = 50
		}
		produces = {
			trigger = {
				planet_owner = {
					country_uses_food = no
				}
			}
			energy = 25
		}
		cost = {
			minerals = 35000
			influence = 150
			sr_dark_matter = 500
			acot_sr_dark_energy = 500
		}	
		cost = {
			trigger = {
				planet_owner = {
					is_ai = yes
				}
			}
			minerals = 1250
			influence = 25
			sr_dark_matter = 100
			acot_sr_dark_energy = 100
		}			
	}
	
	prerequisites = {
		"tech_acot_giga_fortress"
	}
	
	ai_weight = {
		weight = 15000
		modifier = {
			factor = 0
			planet_owner = {
				has_monthly_income = {
					resource = sr_dark_matter
					value <= 3
				}
			}
		}
	}

	upgrades = {
		building_acot_giga_fortress_array
		building_acot_giga_fortress_lab
		building_acot_giga_fortress_obelisk
	}
}

###############################################################
# OTHER STUFFS
###############################################################

building_acot_dm_mansion = {
	base_buildtime = 360
	position_priority = 65

	category = unity
	
	potential = {
		exists = owner
		owner = {
			is_regular_empire = yes
			is_spiritualist = no
			has_make_spiritualist_perk = no
		}
		NOT = { has_modifier = slave_colony }
	}

	allow = {
		has_enigmatic_capital = yes
	}
	
	destroy_trigger = {
		exists = owner
		owner = {
			OR = {
				is_regular_empire = no
				is_spiritualist = yes
				has_make_spiritualist_perk = yes
			}
		}
	}

	convert_to = {
		building_acot_dm_temple
		building_acot_dm_hive_depot
		building_acot_dm_ancient_cryo_chamber
	}

	planet_modifier = {
		planet_housing_add = 25
		planet_amenities_add = 25
		job_acot_entertainer_add = 2	
	}

	resources = {
		category = planet_buildings
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			unity = 12
		}
		cost = {
			alloys = 600
			sr_dark_matter = 200
			acot_sr_dark_energy = 100
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			acot_sr_dark_energy = 2
			sr_dark_matter = 2
		}
	}
	
	prerequisites = {
		"tech_acot_dm_mansion"
	}
	
	ai_weight = {
		weight = 100

		modifier = {
			factor = 300000
			free_amenities < 0
		}
		
		modifier = {
			factor = 500000
			free_housing < 1
		}
		
		modifier = {
			factor = 0
			free_housing > 1
		}
	}

	upgrades = {
		building_acot_ae_mansion		
	}

}

building_acot_dm_temple = {
	base_buildtime = 360
	position_priority = 66

	category = unity
	
	potential = {
		exists = owner
		owner = {
			OR = {
				is_spiritualist = yes
				AND = {
					is_gestalt = no
					has_make_spiritualist_perk = yes
				}
			}
		}
		NOT = { has_modifier = slave_colony }
	}

	allow = {
		has_enigmatic_capital = yes
	}
	
	destroy_trigger = {
		exists = owner
		OR = {
			owner = {
				OR = {
					AND = {
						is_spiritualist = no
						has_make_spiritualist_perk = no
					}
					is_gestalt = yes
				}
			}
			has_modifier = slave_colony
		}
	}

	convert_to = {
		building_acot_dm_mansion
		building_acot_dm_hive_depot
		building_acot_dm_ancient_cryo_chamber
	}

	planet_modifier = {
		planet_housing_add = 25
		planet_amenities_add = 25
		job_acot_priest_add = 2	
		pop_ethic_spiritualist_attraction_mult = 0.25
	}

	resources = {
		category = planet_buildings
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			unity = 16
		}
		cost = {
			alloys = 600
			sr_dark_matter = 200
			acot_sr_dark_energy = 100
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			acot_sr_dark_energy = 2
			sr_dark_matter = 2
		}
	}
	
	prerequisites = {
		"tech_acot_dm_temple"
	}
	
	ai_weight = {
		weight = 100

		modifier = {
			factor = 300000
			free_amenities < 0
		}
		
		modifier = {
			factor = 500000
			free_housing < 1
		}
		
		modifier = {
			factor = 0
			free_housing > 1
		}
	}

	upgrades = {
		building_acot_ae_temple		
	}
}

building_acot_dm_hive_depot = {
	base_buildtime = 480
	position_priority = 67
	
	category = unity
	
	potential = {
		planet_owner = { is_hive_empire = yes }
	}

	allow = {
		has_enigmatic_capital = yes
	}
	
	convert_to = {
		building_acot_dm_mansion
		building_acot_dm_temple
		building_acot_dm_ancient_cryo_chamber
	}
	
	planet_modifier = {
		planet_housing_add = 25
		planet_amenities_add = 25
		job_acot_entertainer_drone_add = 2	
	}

	resources = {
		category = planet_buildings
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			unity = 12
		}
		cost = {
			alloys = 600
			sr_dark_matter = 200
			acot_sr_dark_energy = 100
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			acot_sr_dark_energy = 2
			sr_dark_matter = 2
		}
	}
	
	prerequisites = { tech_acot_dm_hive_depot }
	
	ai_weight = {
		weight = 10
		modifier = {
			factor = 20000
			free_housing < 0
		}

		modifier = {
			factor = 30000
			free_amenities < 2
		}
		
		modifier = {
			factor = 0
			free_housing > 1
		}
	}

	upgrades = {
		building_acot_ae_hive_depot
	}
}

building_acot_dm_ancient_cryo_chamber = {
	base_buildtime = 400
	can_demolish = yes
	position_priority = 68
	
	category = unity
	
	potential = {
		planet_owner = { is_machine_empire = yes }
	}	
	
	allow = {
		has_enigmatic_capital = yes
	}

	convert_to = {
		building_acot_dm_mansion
		building_acot_dm_temple
		building_acot_dm_hive_depot
	}

	planet_modifier = {
		planet_housing_add = 25
		planet_amenities_add = 25
		job_acot_entertainer_droid_add = 2	
	}

	resources = {
		category = planet_buildings
		produces = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			unity = 15
		}
		cost = {
			alloys = 600
			sr_dark_matter = 200
			acot_sr_dark_energy = 100
		}
		upkeep = {
			trigger = {
				has_modifier = acot_modifier_ascended_city
			}
			acot_sr_dark_energy = 2
			sr_dark_matter = 2
		}
	}
	
	prerequisites = {
		"tech_acot_dm_ancient_cryo_chamber"
	}
	
	ai_weight = {
		weight = 10
		modifier = {
			factor = 20000
			free_housing < 0
		}

		modifier = {
			factor = 30000
			free_amenities < 2
		}
		
		modifier = {
			factor = 0
			free_housing > 1
		}
	}

	upgrades = {
		building_acot_ae_ancient_cryo_chamber
	}
}

